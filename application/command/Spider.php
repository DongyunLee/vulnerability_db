<?php

namespace app\command;

use think\console\Command;
use think\console\Input;
use think\console\input\Argument;
use think\console\Output;

class Spider extends Command
{
    protected function configure()
    {
        // 指令配置
        $this->setName('spider')
            // 设置参数
            ->addArgument('max_id', Argument::REQUIRED, 'cnvd上的链接id')
            ->setDescription('automatic import xml');
    }
    
    protected function execute(Input $input, Output $output)
    {
        $id = $input->getArgument('max_id');
        // $think_path = dirname(dirname(__DIR__));
    
        $error_list = [];
    
        $date = date('Y-m-d H:i:s');
        $output->writeln("{$date} Process Starting…");
        for ($i = $id; $i >= 243; $i--) {
            if (!system("php think down {$i}")) {
                $error_list[] = $i;
            }
        }
    
        $error_num = count($error_list);
        $error_list_string = join(', ', $error_list);
        $output->writeln("{$date} Process Finished");
        $output->writeln("{$error_num} Error. There they are:");
        $output->writeln("[{$error_list_string}]");
    }
}
